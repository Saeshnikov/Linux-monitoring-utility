# Утилита top
– консольный диспетчер задач. <br> Она показывает общую информацию о системе и информацию о каждом процессе. С помощью top можно наблюдать в реальном времени динамику работающей системы. 
Программа показывает обобщённую информацию по системе, а также список процессов или потоков, обслуживающихся в настоящее время ядром Linux. 

Можно настроить, какая именно информация о системе и процессах выводится и в каком виде. 
Можно полностью настроить программу под себя для максимально удобного восприятия информации и показа той информации, которая в стандартном режиме отсутствует. Это можно сделать в рамках текущего запуска программы, либо сохранить сделанные изменения, чтобы не настраивать top каждый раз.

## Пример интерфейса top: ##
![image](https://github.com/Saeshnikov/Linux-monitoring-utility/assets/121693400/281d1790-9bdf-46e1-9027-c2fb75cab2c0)

Вывод данной утилиты можно разбить на две части:
*	Сверху – шапка. (общая информация о системе (использовании процессора и оперативной памяти системы))
*	Ниже – информация по каждому процессу

### Общая информация о системе: ###
Шапка стандартного интерфейса top состоит из 5 строк:
![image](https://github.com/Saeshnikov/Linux-monitoring-utility/assets/121693400/e5ba5e67-0c74-4d33-8529-9cb62b91a5de)

На первой строке показаны следующие поля: 
*	текущее время; 
*	как долго работает система после последней загрузки(аптайм); 
*	сколько в системе активных пользователей; 
*	средняя загрузка системы (load average) — три величины, усредненные за последние 1 и 5 и 15 минут. Чем ниже, тем лучше. Если превышает количество ядер на сервере, то значит сервер перегружен. 

Ниже: 
*	количество процессов; 
*	количество работающих в данный момент процессов; 
*	количество спящих процессов; 
*	количество остановленных процессов; 
*	количество зомби процессов.

На третьей строке показана информация о потреблении ЦПУ:
*	us — потребление cpu пользовательскими процессами (top и apache2);
*	sy — потребление cpu системными процессами;
*	ni — потребление cpu пользовательскими процессами, c измененным приоритетом (командой nice или renice);
*	id — простаивание cpu;
*	wa — процент времени, в течение которого процессор простаивал, ожидая завершения операции ввода-вывода. Если слишком высокое (более 10), значит за вашим процессором не поспевает диск, и нужно бы поменять его на более быстрый;
*	hi — процент времени работы аппаратных прерываний. Периферийные устройства могут прерывать работу процессора, чтобы передать какие-то данные;
*	si – процент времени работы программных прерываний. Некоторые приложения могут прерывать работу процессора, чтобы передать какие-то данные;
*	st — процент времени, когда реальный процессор не был доступен виртуальной машине. Будет расти если виртуальной машине выделить больше ядер, чем имеет гипервизор. Этот показатель имеет значение только в системах виртуализации.

Ниже видим информацию по потреблению оперативной памяти (Mem) и подкачки (Swap):
*	total — общее количество памяти;
*	free — количество свободной памяти;
*	used — количество используемой памяти;
*	buff / cache — память, выделенная под буфер и дисковый кэш;
*	avail Mem — память, которая может быть выделена для запуска новых процессов.

### Информация по каждому процессу: ###
Ниже показана информация по каждому процессу. Информация разбита на следующие колонки:
![image](https://github.com/Saeshnikov/Linux-monitoring-utility/assets/121693400/36a64b66-4544-4cb5-838e-ce8464fa236c)

*	PID — уникальный идентификатор процесса;
*	USER — имя пользователя, под которым работает процесс;
*	PR — приоритет задачи в расписании. Если вы в этом поле видите «rt», это означает, что задача запущена в расписании приоритетов в реальном времени (это самый высокий приоритет);
*	NI — значение nice задачи. Негативное значение означает более высокий приоритет, а положительное значение nice означает более низкий приоритет;
*	VIR — общее количество используемой задачей виртуальной памяти в данный момент времени. Включает в себя RES, SHR, прикреплённые файлы (например — файлы библиотек). Также включает в себя память, которая была выделена, но не использована;
*	RES — используемая оперативная память, является подмножеством VIRT, представляет физическую память, не помещённую в раздел подкачки, которую в текущий момент использует задача. Также является суммой полей RSan, RSfd и Rssh;
*	SHR — количество разделяемой памяти, которую использует процесс (размер совместной памяти, подмножество используемой памяти RES). Разделяемая память потенциально может быть разделена с другими процессами;
*	S — состояние процесса (я их уже описывал здесь):
       *	S (sleeping) — спящий;
       *	R (running) — в работе;
       *	Z (zombie) — зомби;
       *	D (бесперебойный сон) — ожидает дискового ввода/вывода, и не принимает никакие сигналы;
       *	T — остановлен сигналом управления работой;
       *	T — остановлен отладчиком  в процессе дебага;
       *	I (Idle) — бездействующий поток ядра.
*	%CPU — использование cpu в процентах;
*	%MEM — RES в процентах от общего количества памяти;
*	TIME+ — сколько времени с этим процессом работал ЦПУ, с точностью до сотых долей секунды;
*	COMMAND — с помощью какой команды запустили процесс.

## Опции команды top ##
1.	Количество итераций 
<br>Опция -n укажет через сколько повторений нужно завершить работу top. По умолчанию чтобы выйти из top нужно нажать клавишу ***q***. Следующая команда выйдет из top через 10 повторений: 
```
$ top -n 10
```

2.	Процессы определённого пользователя 
```
$ top -u www-data
```
Перед именем пользователя можно поставить ***!*** (восклицательный знак) и тогда будут показаны процессы для всех пользователей, кроме указанного.

3.	Показ/скрытие общей нагрузки - необходимо нажать клавишу ***l***
4.	Режим цветности – клавиша ***z*** - цветовую схему можно настроить, то есть можно установить свои цвета.
5.	Показ гистограммы загрузки процессора – клавиша ***t*** - по кругу переключает вид строки обобщённой информации об использовании процессора. 
<br>Варианты:
*	детальная информация по категориям
*	сокращённая пользователь/система и общий % + гистограмма
*	сокращённая пользователь/система и общий % + блок-диаграмма
*	отключение отображения статусов задач и CPU
6.	Показ гистограммы загрузки памяти – клавиша ***m*** - работает аналогично предыдущей команде, но для оперативной памяти (физической и виртуальной).
*	подробные проценты по типу памяти
*	 сокращённый % используемая/общая доступная + гистограмма
*	сокращённый % используемая/общая доступная + блок-диаграмма
*	выключение показа памяти
7.	Сортировка процессов
<br>По умолчанию процессы отсортированы по колонке %CPU. Те, что потребляют больше всего находятся сверху.
Чтобы выделить столбец, по которому сейчас идет сортировка, нажмите клавишу ***x***.
<br>Клавишами «***<***» или «***>***», можно выбрать столбец, по которому нужно сортировать процессы.
<br>А если нажать клавишу ***R***, то сортировка пойдет в обратном порядке.
<br>Клавиша ***M*** отсортирует процессы по потреблению памяти (%MEM).
8.	Больше информации о команде (поле COMMAND)
<br>Можно посмотреть строку команды, которой она была запущена (имя программы вместе с опциями командной строки) с помощью кнопки ***c***. Для возврата к показу имени программы, необходимо нажать ***c*** ещё раз.
9.	Древовидный вид процессов и дочерних процессов
<br>Используя клавишу ***V***, можно переключиться на древовидный вид и обратно. В этом режиме процессы реорганизуются в соответствии с их родителями и столбец ***COMMAND*** показывает это дерево.
<br>В древовидном виде по-прежнему можно использовать интерактивную команду ***c*** для переключения на вид строки команды. Также доступна интерактивная команда ***H*** для переключения между процессами и потоками.
10.	Просмотр потоков 
<br>По умолчанию top показывает суммарную информацию по всем потокам каждого процесса. Используя ***H*** можно переключиться на показ потоков.
11.	Показ только активных процессов
<br>Кнопкой ***i*** можно переключаться между всеми или только активными задачами.
12.	Поменять интервал обновления информации в top
<br>По умолчанию информация обновляется раз в три секунды. Используя интерактивную команду ***d*** или ***s*** можно ввести/установить любой другой интервал.
После нажатия одной из этих кнопок нужно ввести значение в секундах. Можно вводить дробные числа, но нельзя вводить отрицательные.
Если ввести 0, то программа будет непрерывно обновлять информацию и при этом потреблять много процессорного времени.
<br>Если необходимо узнать, какое время задержки установлено в текущий момент, надо нажать ***h*** и во второй строке найти строку со словом Delay.
13.	Поиск в top
<br>Для этого используется ***L*** (Shift+l) (чувствительна к регистру).
<br>Для перехода к следующему совпадению поиска - ***&***.
14.	Сбор фильтров
<br>Для сброса фильтров используются ***=*** и ***+***. Их действия чуть различны, кнопка = действует на текущее видимое окно задач. А кнопка + действует на все окна при альтернативном отображении. Сбрасываются фильтры, установленные с помощью:
*	i (без неактивных задач)
*	n (максимальное число задач)
*	u/U (фильтр по пользователям),
*	o/O (другой фильтр)
*	L (поиск)
15.	Управление полями
<br>По умолчанию отображаются далеко не все поля. Чтобы добавить поля необходимо нажать клавишу ***F***. Затем, с помощью клавиш ***вверх*** и ***вниз***, можно перемещаться по полям.
Чтобы добавить выбранное поле - клавиша ***d*** или ***пробел***. А чтобы выбрать поле для сортировки надо выделить его и нажать ***s***. Чтобы вернуться в режим просмотра – клавиша ***q***.
![image](https://github.com/Saeshnikov/Linux-monitoring-utility/assets/121693400/9d79941f-775a-460e-9472-5fd9dd286245)

16.	Многооконный режим top
<br>Программа top поддерживает работу с несколькими окнами — до четырёх. Причём в каждом из них можно сделать совершенно разные настройки и наблюдать за различными характеристиками системы.
<br>Многооконный вид top называется альтернативным режимом отображения. Для его включения используется клавиша ***A***. Чтобы последовательно переключаться между окнами -
***a*** (переход к следующему) или ***w*** (возврат к предыдущему). 
С помощью интерактивной команды ***g*** можно быстро переключаться между окнами. После её нажатия нужно будет ввести цифры от 1 до 4.
<br>Есть возможность установить имя окна (которое отображается в самом верху, для этого используется команда ***G***. После её отправки нужно будет ввести новое имя текущего окна.
<br>Чтобы спрятать или показать текущее активное окно используется клавиша -. Клавиша ***_*** работает аналогично, но сразу для всех окон.
17.	Завершение процессов
<br>Из top можно завершить процесс, для этого нужно нажать клавишу ***k***, далее ввести pid процесса, который хотим завершить и нажать ***Enter***.
<br>По умолчанию процессу посылается сигнал 15 (sigterm). Но завершать чужие процессы можно только запустив top под пользователем root, или с помощью команды sudo.
18.	Изменение значения nice процесса
<br>Для изменения значения ***nice*** процесса используется клавиша ***r***, после ее нажатия будет предложено ввести PID и затем значение nice для присвоения ему.
<br>Положительное значение nice означает потерю приоритета процессом. По общему правилу, обычные пользователи могут только увеличить значение nice и не могут его понизить.

## Дополнительно ##

### Использование top в скриптах ###
Программа top также поддерживает опции командной строки. Большинство из этих опций соответствуют рассмотренным интерактивным командам — но перед ними нужно поставить дефис.

Сама программа top может использоваться в скриптах. Для выполнения команды в этом режиме применяется опция ***-b***. 
Эта опция полезна для отправки вывода top в другую программу или в файл. В этом режиме top не будет принимать ввод и будет работать до достижения предела повторений, 
который устанавливается ключом ***-n***. К примеру, запуск команды top в пакетном режиме с одним обновлением информации:
```
$ top -b -n 1
```

### Сохранение настроек top ###
Необходимо использовать интерактивную команду ***W*** для записи конфигурационного файла. Она сохранит все опции и переключатели, 
плюс текущий режим отображения и время задержки. Набрав эту команду перед выходом top вы сможете перезапустить её затем в точно таком же состоянии.

Программа напишет, куда именно она сохранила конфигурационный файл. Обычно это файл ***~/.config/procps/toprc***. То есть, если надо сбросить наши пользовательские настройки top, то необходимо просто удалить этот файл.
